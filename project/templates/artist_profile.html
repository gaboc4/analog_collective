{% extends "base.html" %}

{% block content %}

<div class="body-margin">
  <h1 class="title">
    Welcome back, {{user_name}}!
  </h1>

  {% if exception %}
  <p>{{exception}}</p>
  {% endif %}

  <div class="row">
    <div class="col-sm-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">New Song Input</h5>
          {% include 'song_form.html' %}
        </div>
      </div>
    </div>
    {% if playlist_embed_urls %}
    <div class="col-sm-8">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Related Playlists</article>
            {% for url in playlist_embed_urls %}
              <iframe src={{url}} width="200" height="300" frameborder="0" 
              allowtransparency="true" allow="encrypted-media"></iframe>
            {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}  
  </div>

  <div class="row">
    <div class="col-sm-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Current Songs and Related Artists</h5>
          {% if tracks and related_artists %}
            <table class="table curr-artist-card">
              <thead>
                <tr>
                  <th scope="col">Track Name</th>
                  <th scope="col">Track Link</th>
                  <th scope="col">Description</th>
                  <th scope="col">Placed Playlist</th>
                </tr>
              </thead>
              <tbody>
                {% for track in tracks %}
                <tr>
                  {% for key in track %}
                    {% if key.startswith('track_link') %}
                      <td><a href="{{track[key]}}" target="_blank">Link to Track</a></td>
                    {% else %}
                      <td style="word-wrap: break-word;max-width: 160px;">{{track[key]}}</td>
                    {% endif %}
                  {% endfor %}
              </tr>
              {% endfor %}
              </tbody>
            </table>

            <table class="table curr-artist-card">
              <thead>
                <tr>
                  <th scope="col">Related Artist 1</th>
                  <th scope="col">Related Artist 2</th>
                  <th scope="col">Related Artist 3</th>
                  <th scope="col">Related Artist 4</th>
                  <th scope="col">Related Artist 5</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  {% for key in related_artists %}
                  <td>{{related_artists[key]}}</td>
                  {% endfor %}
                </tr>
              </tbody>
            </table>
            {% else %}
            <p>You have no tracks or related artists in the system, add some to the left!</p>
            {% endif %}
        </div>
      </div>
    </div>
    {% if song_img %}
    <div class="col-sm-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Song Details</h5>
            <img src="{{song_img}}">
            {% if song_description %}
            <p>{{song_description}}</p>
            {% endif %}
          </div>
        </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
